HTTP-知识：

----------------------------01----HTTP 的前世今生---------------------\-------------------------

1. 推动 http 发展的原动力：

   1> 用户推动技术发展

   2> 硬件的升级，马太效应， 强者恒强，滚雪球

2. 你是怎么理解HTTP 超文本传输协议的？

   http 是一种网络协议，也是一种约定。是交互双方所遵循的表达式

   

---------------------------02----HTTP是什么---------------------\-------------------------------

**HTTP是什么？**

协议----（包含）----- > 传输------（包含）-----> 超文本

1. 协（必须有两个或多个参与者）

2. 议 （协议是对参与者的一种行为约定和规范）

   http 是一个用在计算机世界里面的协议，它使用计算机能够理解的语言确立了一种计算机之间交流通信的规范，以及相关的各种控制和错误的处理方式。

3. 传输。 A《========》B

   http 是一个双向协议

   传输方式：   A <=> X <=> Y <=> Z <=>B

   HTTP 是一个在计算机世界厘米啊专门用来在两个点之间传输数据的约定和规范。

4. 超文本

   超文本，是一种超越普通文本的文本；它是文字，图片，音频和视频等的混合体，最关键的是含有“超链接”；能够从一个“超文本” 跳跃到另一个 “超文本” 形成复杂和非线性，网状的结构关系。

   HTTP是一个在计算机世界里面专门在两点之间传输文字，图片，音频，视频等超文本数据的约定和规范。
   
   

**HTTP不是什么？**

1. HTTP 不是互联网， HTTP 是构建互联网的一块重要拼图。

2. HTTP 不是编程语言， http 是计算机与计算机沟通交流的语言，可以用编程语言去实现http。

3. http 不是 html， html 是超文本的载体，是一种标记语言。

4. http 不是一个孤立的协议，http 通常跑在 TCP/IP 协议之上， DNS协议， SSL/TLS

   

**小结：**

1. http是一个用在计算机世界里的协议，它确立了一种计算机之间交流通信的规范，以及相关的各种控制和错误处理方式。

2. HTTP 专门用来在亮点之间传输数据，不能用于广播寻址或路由。

3. HTTP 传输的是文字，图片，音频，视频等超文本数据。

4. HTTP 是构建互联网的重要基础技术，它没有实体依赖，依赖许多其他的技术来实现，但同时许多技术也都依赖它。

   

**QA：**

1. 有一种说法：HTTP是用于从互联网服务器传输超文本到本地浏览器的协议，你认为这种说法对吗？

​       ❌，http是一个双向协议，不限定两个角色

2. 你能在说几个http是什么又不是什么吗？

   http是一种协议， 一种约定， 不是一种服务，一种语言，一种网络

---------------------------03---与HTTP相关的各种协议---------------\-------------------------------

1. 互联网世界更像是数不清的大小岛屿组成的“千岛之国”

​       上网 ---> 万维网（90%） mail.   ftp.   ssh.  telnet

​       浏览器（请求方）：

​       浏览器：    “User Agent“  ---- >. 代理 ----> 客户端

​        web 服务器： ---->. Web. Server  ---- 硬件（云）

​                                                              -----软件 （tomcat， nginx）

  **CDN（内容网络分发服务）（Content Delivery Network）**

​       缓存数据，缩短响应时间

​      提供：负载均衡，安全防护，边缘计算，跨运营商网络

   

 **爬虫：（50%流量）** 

​    自动访问 web 资源的应用程序（用户代理）

  **反爬虫（http/html）**

​    缺点：过度消耗网络资源。占用服务器宽带，影响网站对真实数据的分析，甚至导致敏感信息外漏

  **HTML  /WEBService/ WAF**

   html 是 http协议传输的主要内容之一，它描述了超文本页面，用各种标签定义文字，图片等资源和排版布置，最终由浏。 览器“渲染” 出可视化界面。

webService 是一个基于 web（HTTP）的服务器架构技术

WAF （网络应用防火墙）组织 sql 注入，跨站脚本攻击

ModSecurity 继承到 Apache /Nginx



**小结：**

1.  互联网上绝大部分资源都是对 web 资源的访问
2. 浏览器是 http 协议里的请求方，即 User Agent
3. 服务器是 HTTP 协议里面的应答方，常用的有 Apache 和 Nginx
4. CDN 位于浏览器和服务器之间，主要起到缓冲和加速的作用
5. 爬虫是一类UserAgent，是自动访问网络资源的程序



**QA：**

1. CDN  在对待浏览器和爬虫时会有差异吗？

​       无差异，爬虫本身是对 web 资源的访问。CDN只会去计算实际使用多少资源。

2. WebService 与 Web  Service 的理解：

   Web  Service 是软件服务器， 承载应用， 网络服务实体

   WebService 是一种服务方式。 网络服务器

   



---------------------------04---与HTTP相关的各种协议---------------\-------------------------------

**TCP/IP**

TCP/IP 协议实际上是一系列网络通信协议的统称，其中最核心的两个协议是TCP 和 IP， 其他还有UDP， ICMP， ARP等

TCP -----传输层

IP ---- 网际层

IP 协议是 “Internet Protocol” 的缩写，主要目的：解决寻址与路由的问题

IPV4:    2^32.     .  分隔

IPV6:    2^128.   ：分隔

TCP协议是。Transmission Control Protocol。 的缩写

传输控制协议： 位于IP协议之上，基于 IP协议

提供可靠的字节流形式通信，是 http协议得以实现的基础

可靠的：保证数据不会丢失

字节流：保证数据的完整

HTTP 协议是运行在 TCP/IP 上。（Http over TCP/IP）

DNS 和 URI 有什么关系？

DNS 是得以域名解析出真实IP地址的系统

URI 是统一资源标识符，标定了客户端需要访问的资源所处的位置，如果URI中的主机名使用域名，则需要DNS来解析IP



**DNS（Domain Name System）**

在 DNS 中，域名又被称为 “主机名”（Host），域名用 . 分隔，级别从左到右逐渐升高。

com   商业公司

edu    教育机构

cn.uk  国家

主机名（域名） 映射到 IP  -----------域名解析

目前，全世界主要有13组根 DNS 服务器，下面在有许多的顶级DNS，权威 DNS 和更小的本地DNS。逐层递归的实现域名查询。

URI/URL （URI 是另一个常用的表现形式 URL）

URI：（Uniform Resource Identified）统一资源标识符

​           唯一的标记互联网的资源

URL： （Uniform Resource Location）统一资源定位符

eg： http://nginx.org/en/dowmload.html

1. 协议名：（http）
2. 主机名：nginx.org
3. 路径： en/dowmload.html

HTTPS (Http over SSL/TLS)

SSL/TLS : 负责加密通信的安全协议，建立在 TCP/IP之上，也是一个可靠的传输协议，被用作http的下层

HTTPS    <=>   HTTP + SSL/TLS + TCP/IP

SSL：（Secure Socket Layer）3.0 被标准化，

TLS：（Translation Layer Security），简称 SSL

SSL：综合（对称加密，非对称加密，摘要算法，数字签名，数字证书）等技术，为通信双方创建出秘密的安全的传输通道。



**代理（Proxy）**

代理（Proxy）是HTTP协议中请求方和应答方中间的一个环节，作为“中转站” ； 既可以转发客户端的请求，也可以转发服务器的应答。

**代理分类：**

1.匿名代理：完美“隐匿”了被代理的机器，外界看到的只是代理服务器

2.透明代理：透明（外界既知道代理，也知道客户端）

3.正向代理：靠近客户端，代表客户端向服务器发送请求

4.反向代理：靠近服务器端，代理服务器响应客户端的请求

CDN----》代理，代替源服务器响应客户端的请求，通常扮演着透明代理和反向代理的角色。

代理在传输过程中插入了一个中间层

1.负载均衡：把访问请求均匀分散到多台机器，实现访问集群化

2.内容缓存：缓存上下行的数据，减轻后端的压力

3.安全防护：隐匿IP，使用WAF等工具抵御网络攻击，保护被代理的机器

4.数据处理：提供压缩，加密等额外的功能



**小结：**

1. TCP/IP 是网络世界最常用的协议，HTTP通常运行在TCP/IP提供的可靠的传输上
2. DNS域名是IP地址的等价替代，需要域名解析实现到IP地址的映射
3. URI是用来标记互联网资源的一个名字，由协议名+主机名——路径构成，俗称URL
4. HTTPS相当于 HTTP+SSL/TLS+TCLP/IP ，为http套了一个安全的外壳
5. 代理是HTTP传输过程中的中转站，可以实现缓存加速，负载均衡等功能

  

---------------------------05---常说的四层和七层到底是什么？五层六层去哪里了---------------------------

**TCP/IP 网络分层模式**

application  layer/HTTP         应用层（4）      消息/报文（message）

transport  Layer/TCP/UDP   传输层（3）       段（segment）

internet  layer/IP                   网际层（2）       包（package）

link layer MAC                      链接层（1）       帧（frame）

链接层：（link layer），负责在以太网，WIFI 这样的底层网络上发送原始数据包，工作在网卡这个层次，使用 MAC 地址 来标记网络上的这些设备，所以有时候也称 MAC层。

网际层：（internet layer），在链接层基础上，使用IP地址来取代MAC地址，在局域网，广域网组成的网络中找设备只需要把IP翻译成MAC地址。

传输层：（transport layer），保证数据在IP地址标记的两点之间“可靠”的传输，是TCP协议工作的层次（UDP）

应用层：（application layer），有各种面向具体应用的协议。eg：Telent，SSH，Ftp，Smtp， Http



**OSI 网络分层模型（Open System Interconnection Reference Model）**

L7    application layer    ---------  用户接口（http，telnet）------ http www telnet  nfs dns cdn smtp gateway snmp

L6    presentation layer ----- 数据的表现形式，加密解析 --- ASCII encryption RIPL JPEG GIF

L5    session layer  ---- 对应用会话的管理，同步（操作系统，应用读取）--- RPC SQL HFS

L4   transport layer --- 可靠与不可靠的传输，传输的错误检验 ---- TCP UDP

L3   network layer --- 提供逻辑地址，选路 --- 路由器，网关，二层交换机有路由功能  IP

L2   data link layer   --- 成帧，用MAC地址访问媒介，错误检测与修正 --- 交换机，网卡   IEEE802.3/802.2

L1   physical layer  --- 设备之间的比特流的传输，物理层接口，电气特性等 --- 中继器，集线器，电缆，光线  RJ45 Ethernet



四层负载均衡，工作在传输层上，基于 TCP/IP 协议的特性

eg： IP地址，端口号等实现对后端服务器的负载均衡

七层负载均衡，工作在应用层，看到的是 HTTP 协议，解析Http报文里的URL，主机名，资源类型等数据，再用适当的策略转发给后端服务器。

**TCP/IP 协议栈的工作方式**

HTTp 协议的传输过程就是通过协议栈逐次向下，每一层都添加本层的转有数据，层层打包，然后通过写层发送出去，接受数据则是相反的操作，从下往上穿过协议栈，逐次拆包，每层去掉本层的专有头，上层就会等到自己的数据。



传输的过程：

HTTP          ------------- 》             HTTP

   ｜                                                   ｜

TCP                                                 TCP

   ｜                                                   ｜

 IP                                                     IP

  ｜                                                     ｜

MAC ---------------------------------- MAC



**小结：**

1. TCP/IP 分为四层，核心是二层的IP和三层的TCP，HTTP 在第四层
2. OSI 分为7层，基本对应TCP/IP， TCP在第四层， HTTP在第七层
3. OSI 可以映射到TCP/IP， 但期间 一，五，六层消失
4. 日常交流的时候我们通常使用OSI模型，用四层和七层等术语
5. HTTP 利用 TCP/IP 协议栈逐层打包再拆包，实现了数据传输，但下面的细节并不可见

非绝对化的辨别四层和七层的方式：

凡事由操作系统负责处理的就是四层或四层以下

凡事由应用程序（自己写的代码）负责处理的就是七层



**QA：**

1. 二层转发，三层路由的理解

​      二层转发：交换机，只认识MAC地址，所以建立MAC地址和端口的映射关系，来决定往哪个端口转发

​      三层路由：；路由器，利用IP地址和port，根据路由表选择最佳路径来转发包

2. DNS协议在那一层：

​      应用层

3. CDN工作在那一层：

​     应用层

4. TCP协议栈，位于OSI “五层” 和“六层” 的有哪些

​      UNIX 套接字

5. Mac地址，也成为局域网地址，可以唯一的标识一个网卡，也就同时表示了此网卡所有的设备



--------------------------06--域名有哪些门道------------------------------------------------------

**域名解析：（域名转化为IP地址）**

DNS 的核心系统是一个三层的树桩，分布式服务器，基本对应域名的结构

1.根域名服务器（Root DNS Server）：管理顶级域名服务器，返回 com，cn，net 等顶级域名服务器的IP地址

2.顶级域名服务器（Top-level DNS Server）：管理各自域名下的权威域名服务器，比如 com顶级域名，返回，apple，com的IP地址

3.权威域名服务器（Authoritative DNS Server: 管理自己域名下的主机IP地址 apple.com 返回 www.apple.com 的IP地址

​                                                    根 DNS

​          com                                        org                    cn                 ... 

  apple.com  github.com              w3c.org            12306.cn        ....

  www.apple.com

eg：访问  www.apple.com 就要进行下面的三次查询：

1.访问根域名服务器，返回 "com" 顶级域名服务器的地址

2.访问 "com" 顶级域名服务器的地址，返回 "apple.com" 域名服务器的地址

3.访问 "apple.com"  域名，返回 "www.apple.com" 的地址



**DNS缓存：**

运营商建立了自己的DNS服务器，作为用户DNS查询的代理，代替用户访问核心的DNS系统，这些“野生”的服务器被称为“非权威域名服务器”；可以缓存之前的查询结果，如果已经有了记录，就无需再次向根域名服务器发起查询，直接返回对应的IP地址



**知名DNS：**

Google：    8.8.8.8

Microsoft:   4.2.2.1

CloudFlare:  1.1.1.1

主机映射文件： win: C:\WINDOWS\system32\drivers\etc\hosts

​                           Linux:    /etc/hosts

Nginx： 配置 DNS服务器的指令 resolver

resolver  8.8.8.8 valid =30s; 指定 Google的 DNS 缓存 30s



**域名的新玩法：**

1.重定向

主键需要下线，迁移时，更改DNS记录，让域名指向去他机器（博客迁移）

2.bind9 开源软件搭建内部使用的DNS

   1》域名解析可以返回多个IP地址，所以一个域名可以对应多台主机，客户端收到多个IP地址后，就可以使用轮询算法，依次向服务器发起请求，实现负载均衡。

   2》域名解析可以配置内部和策略，返回离客户端最近的主机，或者返回当前服务器质量最好的主机。DNS请求分发到不同的服务器，实现负载均衡。



**域名屏蔽：**

对域名直接不解析，返回错误，无法等到IP访问网络。

**域名劫持：**

“域名污染”，需要访问A网站，但是DNS给了B网站。



**小结**：

1.域名使用字符串来代替IP地址，方便用户记忆，本质上一个名字空间系统。

2.DNS就像是现实世界里的电话本，查号台，统管着互联网世界里的所有网站，是一个超级大管家。

3.DNS 是一个树状的分布式查询系统，但是为了提高查询效率，外围有多级的缓存。

4.使用DNS可以实现基于域名的负载均衡，既可以在内网，也可以在外网。



**QA：**

1. 在浏览器地址栏里随便输入一个不存在的域名，www.不存在.com，试着解释一下它的DNS解析过程：

​       浏览器缓存-------操作系统缓存------hosts-----dns-----非核心的dns服务器------根域名服务器------顶级域名服务器-----二级域名服务器

2. 如果因为某些原因，DNS失效或者出错了，会出现什么后果？

​     域名屏蔽     域名污染      本地hosts绑定       野生dns服务器拦截       dns切换失效       ttl时间变动



